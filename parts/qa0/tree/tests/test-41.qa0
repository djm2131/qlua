(verbose ([c99 bgl/xlc dry] "#include <complex.h>"))
(verbose ([c99 bgl/xlc dry] "struct Fermion;"))
                               
(procedure K-n ([stem "K"] count-flops)
              ([res  pointer "res"  "struct Fermion *"               ]
               [src  pointer "src"  "const struct Fermion *"         ])
  (load qcd-fermion () x ([reg src]))
  (repeat ([d (const 0) (const *dim*)]
           [s (plus minus)])
     (op nop (start operation dir d s) () ())
     (op nop (project d s) () ())
     (op qcd-project ([project d s]) (z) ([reg x]))
     (op nop (unproject d s) () ())
     (op qcd-unproject ([unproject d s]) (q) ([reg z]))
     (store qcd-fermion () ([reg res]) [reg q])
     (op nop (unproject-add d s) () ())
     (op qcd-unproject-add ([unproject d s]) (q) ([reg x] [reg z]))
     (store qcd-fermion () ([reg res]) [reg q])
     (op nop (unproject-sub d s) () ())
     (op qcd-unproject-sub ([unproject d s]) (q) ([reg x] [reg z]))
     (store qcd-fermion () ([reg res]) [reg q])
     (op nop (end operation dir d s) () ())))